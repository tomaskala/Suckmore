#!/bin/sh

render() {
  muted=$(pamixer --get-mute)
  vol_perc=$(pamixer --get-volume)
  bat_charging=$(cat /sys/class/power_supply/BAT0/status)
  bat_perc=$(cat /sys/class/power_supply/BAT0/capacity)
  current_date=$(date +'%a %F')
  current_time=$(date +'%H:%M')

  if [ "${muted}" = true ]; then
    vol_status='ğŸ”‡'
  elif [ "${vol_perc}" -le 30 ]; then
    vol_status='ğŸ”ˆ'
  elif [ "${vol_perc}" -le 70 ]; then
    vol_status='ğŸ”‰'
  else
    vol_status='ğŸ”Š'
  fi

  if [ "${bat_charging}" = Charging ]; then
    bat_status='âš¡'
  elif [ "${bat_charging}" = Discharging ]; then
    bat_status='ğŸ”‹'
  else
    bat_status='ğŸ”Œ'
  fi

  printf '%s %d%% %s %d%% ğŸ“… %s ğŸ•“ %s\n' \
    "${vol_status}" \
    "${vol_perc}" \
    "${bat_status}" \
    "${bat_perc}" \
    "${current_date}" \
    "${current_time}"
}

trap render USR1

while true; do
  render
  sleep 1 &
  wait $!
done
